<!DOCTYPE html>
<!-- This site was created in Webflow. http://www.webflow.com -->
<!-- Last Published: Wed Nov 28 2018 22:11:26 GMT+0000 (UTC) -->
<html data-wf-domain="livecodestream.webflow.io" data-wf-page="5bfef6fd1f55a9f7267133b6" data-wf-site="5bfef6fc1f55a971e87133b1"
   data-wf-status="1">

<head>
   <script>
      if (!location.hash) {
         window.channel = '#' + (Math.random() * 100).toString().replace('.', '');
      } else {
         window.channel = location.hash;
      }
      console.log(window.channel);      
   </script>
   <meta charset="utf-8" />
   <title>livecodestream</title>
   <meta content="width=device-width, initial-scale=1" name="viewport" />
   <meta content="Webflow" name="generator" />
   <link rel="stylesheet" href="style.css">
   <link href="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/css/livecodestream.webflow.5f0bdd4b4.css" rel="stylesheet"
      type="text/css" />
   <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js" type="text/javascript"></script>
   <script type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic", "Varela Round:400", "Varela:400"] } });</script>
   <!--[if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif]-->
   <script type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
   <link href="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a96b1b7133bf_webclip-gallio.png"
      rel="shortcut icon" type="image/x-icon" />
   <link href="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a96b1b7133bf_webclip-gallio.png"
      rel="apple-touch-icon" />
   <script type="text/javascript">(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-33205505-10', 'auto'); ga('set', 'page', location.hash); ga('send', 'pageview');</script>
   <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
   <script src="https://cdn.webrtc-experiment.com/CodecsHandler.js"></script>
   <script src="https://cdn.webrtc-experiment.com/IceServersHandler.js"></script>
   <script src="https://cdn.webrtc-experiment.com/MultiStreamsMixer.min.js"></script>
   <script src="script.js"> </script>
   <script src="canvasFill.js"></script>
</head>

<body>
   <header class="nav-bar">
      <div class="w-container">
         <div class="w-row">
            <div class="brand-column w-col w-col-4">
               <img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bff03494a02e1638f06b0b6_laptop.svg"
                  width="41px" alt="" class="logo" />
               <div class="company">livecodestream</div>
            </div>
            <nav class="nav-column w-col w-col-8"></nav>
         </div>
      </div>
   </header>

   <div class="section hero">
      <div class="w-container">
         <h1 class="hero-heading">Stream your live coding session</h1>
         <p class="hero-subhead">No more complicated setup, just one click straight from your browser</p>
         <div class="button-group" id="stream-button"><a href="javascript:startStream();" target="_blank" class="button sign-up">Start
               Streaming</a><a href="#features" class="button">see features</a></div>
         <div id="loader" class="centered"></div>
         <div id="loader_text">Loading stream...</div>
         <div id="local-streams-container">
            <canvas id="canvas-id"></canvas>
         </div>
         <div id="remote-streams-container"></div>
         <script>
            var meeting = new Meeting();
            window.meeting = meeting;
            var interval;

            var meetingsList = document.getElementById('meetings-list');
            var meetingRooms = {};
            meeting.onmeeting = function (room) {
               // document.getElementById('welcome').style.visibility = 'hidden';
               if (meetingRooms[room.roomid]) return;
               meetingRooms[room.roomid] = room;

               room = meetingRooms[room.roomid];
               if (room) meeting.meet(room);
            };

            var remoteMediaStreams = document.getElementById('remote-streams-container');
            var localMediaStream = document.getElementById('local-streams-container');

            // on getting media stream
            meeting.onaddstream = function (e) {
               if (e.type == 'local') {
                  createChat();
                  localMediaStream.appendChild(e.video);
                  e.video.addEventListener("playing", function () {
                     grabFrame();
                  });
               }
               if (e.type == 'localme') {
                  localMediaStream.appendChild(e.video);
               }
               if (e.type == 'remote') {
                  createChat();
                  remoteMediaStreams.insertBefore(e.video, remoteMediaStreams.firstChild);
               }
               if (e.type == 'remoteme') {
                  remoteMediaStreams.insertBefore(e.video, remoteMediaStreams.firstChild);
               }
            };

            function grabFrame() {
               var theImageCapturer = new ImageCapture(meeting.stream.getVideoTracks()[0]);
               theImageCapturer.grabFrame()
                  .then(function (a) {
                     console.log(" frame grabbed " + a);
                     theGrabbedFrame = a;

                     var canvas = document.createElement("canvas");
                     document.body.appendChild(canvas);

                     canvas.width = theGrabbedFrame.width;
                     canvas.height = theGrabbedFrame.height;
                     canvas.className = "w3-round w3-border w3-card-16";
                     var context = canvas.getContext("2d");
                     context.drawImage(theGrabbedFrame, 0, 0);
                     console.log(" theGrabbedFrame has been painted (maybe)");

                     writeImage(window.channel.replace("#", ""), canvas.toDataURL('image/jpeg', 1));
                     document.body.removeChild(canvas);
                  });
            }

            function writeImage(streamId, data) {
               // Create a root reference
               var storageRef = firebase.storage().ref();

               // Create a reference to 'mountains.jpg'
               var mountainsRef = storageRef.child(streamId + '.jpg');

               // mountainsRef.put(data).then(function (snapshot) {
               //    console.log('Uploaded a blob or file!');
               // });

               mountainsRef.putString(data, 'data_url').then(function (snapshot) {
                  console.log('Uploaded a data_url string!');
               });

               // firebase.database().ref('streams/' + streamId).set({
               //    viewers: 0,
               //    image: data,
               // });
            }

            function createChat() {
               var chatContainer = document.getElementById('chat_container');
               // document.write('<div id="tlkio" data-channel="livecodingstream" data-theme="theme--minimal" style="width:15%;height:100%;position:fixed;bottom:0;right:0;background:#FFFFFF;"></div>');      
               var chatDiv = document.createElement('div');
               chatDiv.id = 'tlkio';
               chatDiv.setAttribute("data-channel", window.channel.replace("#", ""));
               chatDiv.setAttribute("data-theme", "theme--minimal");
               chatDiv.style.width = '15%';
               chatDiv.style.height = '100%';
               chatDiv.style.position = 'fixed';
               chatDiv.style.right = '0px';
               chatDiv.style.bottom = '0px';
               chatDiv.style.background = '#FFFFFF';
               chatContainer.appendChild(chatDiv);

               var chatContainer = document.getElementById('chat_container');
               var chatScript = document.createElement('script');
               chatScript.setAttribute('async', '');
               chatScript.setAttribute('src', 'https://tlk.io/embed.js');
               chatScript.setAttribute('type', 'text/javascript');
               chatScript.onload = function () {
                  var evt = document.createEvent('Event');
                  evt.initEvent('load', false, false);
                  window.dispatchEvent(evt);
                  clearInterval(interval);
               };
               chatContainer.appendChild(chatScript);
            }

            // via: https://github.com/muaz-khan/WebRTC-Experiment/tree/master/websocket-over-nodejs
            meeting.openSignalingChannel = function (onmessage) {
               // var channel = location.href.replace(/\/|:|#|%|\.|\[|\]/g, '');
               var channel = window.channel;
               // wss://websocket-over-nodejs.herokuapp.com:443/
               var websocket = new WebSocket('wss://webrtcweb.com:9449/');
               websocket.onopen = function () {
                  websocket.push(JSON.stringify({
                     open: true,
                     channel: channel
                  }));
               };
               websocket.push = websocket.send;
               websocket.send = function (data) {
                  if (websocket.readyState != 1) {
                     return setTimeout(function () {
                        websocket.send(data);
                     }, 300);
                  }

                  websocket.push(JSON.stringify({
                     data: data,
                     channel: channel
                  }));
               };
               websocket.onmessage = function (e) {
                  onmessage(JSON.parse(e.data));
               };
               return websocket;
            };

            // using firebase for signaling
            // meeting.firebase = 'muazkh';

            // if someone leaves; just remove his video
            meeting.onuserleft = function (userid) {
               var video = document.getElementById(userid);
               if (video) video.parentNode.removeChild(video);
            };

            // check pre-created meeting rooms
            meeting.check();
         </script>

         <!--             <img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app.png" width="940" srcset="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app-p-500.png 500w, https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app-p-800.png 800w, https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app-p-1080.png 1080w, https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app-p-1600.png 1600w, https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfefb376ce0093d1cca1fe7_app.png 1880w" sizes="(max-width: 479px) 94vw, (max-width: 767px) 95vw, (max-width: 991px) 728px, 940px" alt=""/> -->
      </div>
   </div>
   <div id="features" class="section centered">
      <div class="w-container">
         <div id="available_streams"></div>
         <h2 class="section-title">Build for YOU with simplicity in mind</h2>
         <div class="w-row">
            <div class="w-col w-col-4 w-col-small-4">
               <div class="icons"><img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a9d3c77133d1_9-icon2-video.png"
                     width="25" alt="" /></div>
               <h3>Quick</h3>
               <p>No desktop or server setup needed. One button to start streaming your IDE, screen or chrome tab that
                  simple</p>
            </div>
            <div class="w-col w-col-4 w-col-small-4">
               <div class="icons"><img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a9efd77133c3_9-icon2-chat.png"
                     width="25" alt="" /></div>
               <h3>Chat</h3>
               <p>Nothing better then interact with your viewers. Have a microphone? You can talk while you stream.</p>
            </div>
            <div class="w-col w-col-4 w-col-small-4">
               <div class="icons"><img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a981d37133c4_9-icon2-drops.png"
                     width="25" alt="" /></div>
               <h3>Styles</h3>
               <p>We are working hard to get this project off the ground. Feedback and feauture request are much
                  appreciated</p>
            </div>
         </div>
      </div>
   </div>
   <footer class="section footer">
      <div class="w-container">
         <div class="w-row">
            <div class="w-clearfix w-col w-col-6">
               <img src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bff03494a02e1638f06b0b6_laptop.svg"
                  width="41px" alt="" class="logo" />
               <div class="footer-text">/Streaming starts here</div>
            </div>
            <div class="right-footer-col w-col w-col-6"><a href="https://twitter.com/qvdev" target="_blank" class="social-icon w-inline-block"><img
                     src="https://uploads-ssl.webflow.com/5bfef6fc1f55a971e87133b1/5bfef6fd1f55a99e227133d0_14-social-twitter.png"
                     width="20" alt="" /></a></div>
         </div>
      </div>
   </footer>
   <div id="chat_container">
      <!-- <div id="tlkio" data-channel="livecodingstream" data-theme="theme--minimal" style="width:15%;height:100%;position:fixed;bottom:0;right:0;background:#FFFFFF;visibility: hidden;"></div> -->
      <!-- <script async src="http://tlk.io/embed.js" type="text/javascript"></script> -->
      <!-- <div id="tlkio" data-channel="livecodingstream" data-theme="theme--minimal" style="width: 15%; height: 100%; position: fixed; right: 0px; bottom: 0px; background: rgb(255, 255, 255);"></div> -->
      <!-- <script async="" src="http://tlk.io/embed.js"></script> -->
   </div>
   <script>
      if (!location.hash || !window.meeting.stream) {
         document.getElementById("loader").style.display = "none";
         document.getElementById("loader_text").style.display = "none";
      }                       
   </script>

   <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase.js"></script>

   <script>
      // Initialize Firebase
      var config = {
         apiKey: "AIzaSyCqwaDvvQLU7r9vPIwVagF9zxO3I-L50Lc",
         authDomain: "liveconding.firebaseapp.com",
         databaseURL: "https://liveconding.firebaseio.com",
         projectId: "liveconding",
         storageBucket: "liveconding.appspot.com",
         messagingSenderId: "110342107464"
      };
      firebase.initializeApp(config);


      firebase.database().ref("streams").on('value', (snapshot) => {
         var content = '<p>';
         var images = [];
         var count = 0;
         snapshot.forEach((child) => {
            var link = '<a href=' + location.origin + "/#" + child.key + ' target="_blank">';
            content += link;

            content += "<img src='' id='" + child.key + "' height='125px' width='200px'/>"
            content += "<BR>VIEWERS::" + child.val().viewers;
            content += '</a>  &nbsp;  &nbsp;  &nbsp;';

            images.push(child.key);
            count++;
            if (count == 3) {
               content += "<BR><BR>";
               count = 0;
            }
         });
         content += "</p>";
         document.getElementById('available_streams').innerHTML = content;
         images.forEach((id) => {
            getImage(id);
         });
      });

      function getImage(imageId) {
         var storageRef = firebase.storage().ref();
         // Create a reference to the file we want to download
         var starsRef = storageRef.child(imageId + '.jpg');

         // Get the download URL
         starsRef.getDownloadURL().then(function (url) {
            console.log(url);
            document.getElementById(imageId).src = url;
         }).catch(function (error) {

            // A full list of error codes is available at
            // https://firebase.google.com/docs/storage/web/handle-errors
            switch (error.code) {
               case 'storage/object-not-found':
                  // File doesn't exist
                  console.log("File doesn't exist");
                  break;
               case 'storage/unauthorized':
                  // User doesn't have permission to access the object
                  console.log("User doesn't have permission to access the object");
                  break;
               case 'storage/canceled':
                  // User canceled the upload
                  console.log("User canceled the upload");
                  break;
               case 'storage/unknown':
                  // Unknown error occurred, inspect the server response
                  console.log("Unknown error occurred, inspect the server response");
                  break;
            }
         });
      }
   </script>

</body>

</html>